#!/bin/bash

copy() {
  local destination=$1

  mkdir -p ./"$destination/bin"
  rm -rf ./"$destination"/bin/*

  cp -r ./tmp/* ./"$destination"/bin/

  git add ./"$destination"/bin/*
}

if ! git diff --cached --name-only | grep -q '^DotNet/'; then
  echo "No changes detected in DotNet. Skipping build."
  exit 0
fi

mkdir -p ./tmp

dotnet publish DotNet/StoreGate \
  --output ./tmp \
  --configuration Release \
  --runtime linux-x64

copy "Run/ReleaseGitHub"
copy "Run/UpdateVersion"

rm -rf ./tmp